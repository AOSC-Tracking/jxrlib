version: 0.1.{build}
environment:
  MAVEN_SERVER_USERNAME:
    secure: NHojTgftWGEuFELngMwvtw==
  MAVEN_SERVER_PASSWORD:
    secure: XUQb599qvG/NeUfpgu9ObA==
build_script:
  - msbuild "jxrencoderdecoder\JXR_vc14.sln" /verbosity:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"
install:
  - choco install swig
before_build:
  - set
  - ps: (Get-Content java\settings.xml) -replace '__MAVEN_SERVER_USERNAME__', "$env:MAVEN_SERVER_USERNAME" | Out-File C:\Users\appveyor\.m2\settings.xml
  - ps: (Get-Content java\settings.xml) -replace '__MAVEN_SERVER_PASSWORD__', "$env:MAVEN_SERVER_PASSWORD" | Out-File C:\Users\appveyor\.m2\settings.xml
  - dir C:\Users\appveyor\.m2
  - type C:\Users\appveyor\.m2\settings.xml
  - mkdir java\target\swig\ome\jxrlib
  - swig.exe -java -c++ -package ome.jxrlib -outdir java\target\swig\ome\jxrlib -o java\target\swig\JXR_wrap.cxx java\JXR.i
after_build:
  - mvn -f java\native-windows_64\pom.xml package
  - dir C:\Users\appveyor\.m2
artifacts:
  - path: 'java\native-windows_64\target\*.jar'
cache:
# Don't repopulate the entire Maven repository every time we build
  - C:\Users\appveyor\.m2\repository
